操作系统
	1.操作系统介绍
	2.进程管理
	3.进程调度与死锁
	4.内存管理
	5.文件系统
	6.I/O设备管理
    


操作系统 系统软件 负责管理资源
功能 用户与硬件之间的接口，资源的管理者，为应用程序提供环境
软件分为系统软件和应用软件
计算机所有功能 硬件
程序的执行必须依靠处理机任意时刻只能执行一个程序流
多道程序系统 多批道处理系统和分时系统
单道批处理系统 程序使指令的集合，CPU依次、逐条执行命令 
单道批处理系统特点：自动性、顺序性、单道性
多道批处理系统特点：多道性、无序性、调度性、复杂性
分时操作系统特点：多路性、独立性、及时性、交互性
实时操作系统 目标：快速响应  多路性、独立性、及时性、交互性、可靠性 可靠性要求最高
IBM360 集成电路芯片
MULTICS、UNIX、Linux、Windows 多道程序系统
CTSS IBM7094 通用分时系统
实现用户主机及时交互的是分时操作系统
实现计算机正确性 依赖于系统计算的逻辑结果和产生正确结果的时间
服务器提供的服务：打印、文件、Web服务
嵌入式操作系统特征：小巧、实时性、可装卸、代码固化、弱交互性、强稳定性、接口统一、低耗能
嵌入式操作系统主要特点：微型化和实时性
嵌入式操作系统的应用领域：掌上电脑、智能收集、数码相机、自动售货机、自动提款机、工业控制设备、医疗设备、网络设备、游戏机、军工装备
服务器操作系统Solaris、FreeBSD、Linux、Windows Server 200X
微机操作系统：Windows的个人计算机操作系统、Linux的不同发行版、Macintosh、Chrome OS
现代操作系统支持多任务，特征：并发、共享、虚拟、异步



中断分同步中断(异常Exception，cpu控制单元)：和异步中断(中断Interrupt，其他硬件设备)：外部可屏蔽中断(I/O设备)和外部不可屏蔽中断(紧急事件如硬件故障)
响应中断 条件开中断、时机外部中断到来
中断向量
中断描述表  内存中的地址=idtr中的地址+8*中断向量的值
可编程间隔定时器PIT 时间驱动程序 jiffes时钟滴答数 组成：晶振、计数器、保持寄存器
时钟源 应用程序 OS时钟(PC主板，系统控制) BIOS(RTC有关的固化程序) 实时时钟RTC(最原始最底层的数据)
操作系统内核完成的定时测量 保存当前日期和时间 维持定时器，依靠时间硬件PIT和时钟软件


进程调度算法
短进程优先调度算法SPF
先来先服务调度算法FCFS
优先权调度算法，静态和动态，抢占和非抢占
时间片轮转调度算法RR
多级反馈队列调整调度,饥饿问题，老化技术 

minix 任务、服务、用户


优先权调度算法
时间片轮转调度算法RR
多级队列调度
先来先服务算法FCFS

实时系统 进程调度 开始截止时间
快速机制  对外部中断的快速响应能力 快速的进程切换能力
抢占调度算法根据抢占CPU的不同 基于时钟中断的抢占和立即抢占
松弛度 实时进程紧迫程度 L(松弛度)=T(完成截止时间)-Tc(当前时间)-Ts(处理完成还需时间)
进程切换 程序计数器和其他寄存器在内的CPU上下文信息
多处理器分类 耦合程度分为紧密耦合(共享存储器系统和I/O设备,高速总线或高速交叉开关,独立的存储器模块)和松弛耦合(通道和通信线路) 结构不同分为对称(功能和结构)和非对称(多种处理单元)
对称多处理器 静态分配方式(开销小)和动态分配方式(负载均衡问题)
非对称处理器 主-从(系统处理比较简单)
死锁的条件 互斥、请求和保持、不剥夺、环路等待条件 m=n(k-1)+1 m资源个数 n进程数 k每个进程最大需求量
环路等待死锁 环形链
系统处于安全状态 N(W-1)+1<=M  M资源数量 N进程个数 W最大需求

存储器系统 不同容量、成本、访问时间的存储设备的层次结构
存储器层次结构L0 少量快速CPU寄存器、L1 芯片内高速缓存、L2 芯片外的高速缓存、L3 DRAM 主存储器、L4 本地磁盘、L5 远程二级存储网络
存储设备高层到底层设备速度更慢、容量更大、价格更便宜 
高级语言程序必须通过编译、链接才可能成为可执行程序
链接分为 不属于操作系统的构成部分，为操作系统提供可装入的程序模块
	动态链接 优点节省内存和外存空间
	静态链接 链接模块到装入模块 不够灵活方便重新链接 对逻辑地址进行修改、变换外部调用符号
链接程序解决的问题将编译后的目标模块装配成一个可执行的程序

程序装入 目标程序的指令和数据地址的修改 重定位 绝对装入方式、可重定位装入方式、动态运行时装入方式
绝对装入 物理地址 程序和数据 内存
源程序地址 符号 编译可重定位地址 编译、链接、装入
用户进程放在物理内存的任意位置
静态重定位 物理地址=有效逻辑地址+程序在内存中的起始地址
代替重定位 物理地址=有效逻辑地址+重定位寄存器地址
连续分配方式：单一连续区分分配方式、固定分区分配方式、动态分配区分方式
系统区 用户区 基址寄存器 
界限寄存器存放装入用户程序的地址范围
固定分区分配 内存回收 空闲 state0 已占用 内存分配 内存分区使用表 空闲分区表数据结构(分区编号、分区大小、分区起始地址、分区状态)
动态分区分配：首次适应、循环首次适应，最佳适应 空闲分区表和空闲分区链 空间合并
最佳适应算法BF、 空闲区链 避免大材小用，内存利用率高 分配空间后需要排序，从小到大
首次适应算法FF 递增
循环首次适应算法 空闲区分布均匀、查找开销较小 一次分一块，下次分下一块
空闲分区链 结点
数组大小根据系统管理的 最大分区数


页(片)、页表(页号到页框号)、页框或页帧(存储块)
A逻辑地址、L为页大小、P为页号、W为页内偏移量
P=INT(A/L) 向下取整
W=MOD(A/L) 取余
页框大小=2^n 为页框大小 
物理地址=页框大小*页框号+页内偏移量
页框号=物理空间/页大小
页号 8个页 页号为3  
页内偏移量 1kb 2^10，偏移量为10
逻辑地址 10+3=13位
32个物理块 2^5 块号有5位，块内地址位数和页内地址数相同即10为 物理地址 5+10=15位
页表项位数=物理地址空间大小/页大小
页表的数量=页的数量
TLB 键和值  最近被访问过的页表项  操作系统内核代码 找不到页号则查找内存页表 TLB命中率

二级分页系统 页目录表 页表 页框号
反制页表 进程号和页号 检索页框号 进程逻辑地址空间页表项
空闲页框链表 地址递增  地址信息、指向后面结点的指针、指向前面结点的指针  位图

虚拟存储区 请求调入和置换功能 包括离散性、多次性、对换性、虚拟性  虚拟存储技术
引入虚拟存储技术的目的
提高内存利用率，提供多道程序度，把逻辑地址和物理地址分开


缺页异常 保存了被中断的进程的寄存器和程序计数器信息
请求分页 特殊的页表、缺页异常机构、支持请求分页的地址变换机构
标识页访问权限 保护位
标识页是否存在内存 状态位
页表逻辑地址道物理地址映射时需要 页号和页框号的对应关系
保证进程正常运行所需要的最小页框 硬件结构 指令的格式、功能和寻址方式
两种置换策略 局部置换、全局置换 页框数量，固定、可变

预先调入页
外存中的页 对换区 文件区 相邻 缺页从对换区

页置换算法
最近最久未使用算法LRU 解决两个问题：多久时间未被进程访问，最近最久未使用的页
先进先出算法FIFO 实现简单，效率较低 缺页率 频繁程度 队首队尾
最佳置换算法
简单CLock算法

页缓冲算法 采用FIFO算法选择换出页
最少使用置换 访问计数器值最小的  淘汰页
改进型Clock 使用情况 置换代价 未使用多的页，未被修改过的页
简单CLock 访问过的页设置一个访问位，所有页都通过链接指针接成一个循环队列
栈顶端 最近最久未使用的页号
硬件支持LRU比较困难，附加引用法、简单的Clock算法和改进型Clock算法
LRU 访问字段 t值最大的页换出
页置换算法 内存页选择换出页的算法


外存调入缺页
请求调入和置换技术以时间换空间
降低缺页率 工作集
抖动 进程太多 分配的页框太少
有效访问时间=(1-p)*ma+P*缺页异常时间 
P缺页率 ma存储器访问时间 缺页异常时间=缺页异常服务时间+缺页读入时间+进程重新执行时间
1ms=1000us

分段管理 二维的逻辑地址  由段号和段内地址组成  
分页管理 一维  逻辑地址 地址空间
段表项长度式一个段表项所占用的字节数
CPU寄存器有CPU运行进程的段表起始地址
段基址就是段在屋里内存中的起始地址
段的大小叫段界限
段表可以指定一个段在物理内存中的地址 
段表式由操作系统维护的用与支持分段存储管理地址映射的数据结构


文件系统
I/O系统包括I/O设备、与设备相连的设备控制器、输入/输出控制的计算机即通道，通过总线与CPU、内存相连
I/O系统分主机I/O系统和微机I/O系统，主机I/O系统采用四级结构包括：主机、通道、控制器、设备
总线I/O系统中CPU与内存之间可以直接进行信息交换，不能与设备直接进行信息交换，必须进过设备控制器

I/O设备分类
	传输速率：低速(几个到几百，鼠标)、中速(几千到上万，打印机)、高速(磁带机、磁盘机、光盘机)
	信息交换的单位：分为块设备和字符设备
	设备的共享属性：独占设备、共享设备、虚拟设备
I/O控制器：轮询、中断、DMA  磁盘驱动DMA
中断控制 提高CPU的利用率和系统的吞吐量
缓冲 处理消息的分段和重组
单缓冲
双缓冲
循环缓冲 Nextg：消费者下一个可用装有数据的缓冲 Nexti：生产者下一个可用的缓冲区 Current：正在使用的工作缓冲区 Getbuf使用缓冲区，Releasebuf释放缓冲区
组成
公共缓冲池包含 getbuf putbuf
	三种类型缓冲区：空缓冲区、装满输入数据的缓冲区、装满输出数据的缓冲区
	三种缓冲队列：空缓冲队列emq、输入队列inq、输出队列outq
	四种工作缓冲区：收容输入数据的缓冲区、提取输入数据的缓冲区、收入输出数据的缓冲区、提取输出数据的缓冲区
每当进程向系统提出I/O请求时，设备分配程序按照一定的策略把设备分配给用户
设备分配的数据结构包括：设备控制表DCT、控制器控制表COCT、通道控制表CHCT、系统设备表SDT
设备控制表包括：设备类型、设备标识符、设备状态忙/闲、指向控制器表的指针、重复执行的次数或时间、设备队列的队首指针
控制器表包括：控制器标识符、控制器状态、与控制器相连接的通道表指针、控制器队列的队首指针、控制器队列的队尾指针
通道控制表包括：通道标识符、通道状态、与通道连接的控制器表首址、通道队列的队首指针、通道队列的队尾指针
系统设备表：SDT是系统范围的数据结构，其中记录了系统中全部设备的情况，包括设备类型、设备标识符、设备控制器以及设备驱动程序入口地址
设备分配，固有属性独占性、共享性、可虚拟性
I/O 请求优先级相同，先来先服务原则排毒  基于优先权的分配算法和先来先服务算法
设备独立性 提高操作系统的可适应性和可扩展性 逻辑设备名称、物理设备名称 应用程序独立于具体使用的物理设备
SPOOling 输入缓冲区暂存输入数据
输入井和输出井位于磁盘的存储区域
实现I/O的独立性 异步传输
设备驱动程序遵循操作系统提供的内核和设备驱动的标准接口
磁盘存储器
扇区包括：标识符字段(SYNCH 定界符，磁道、磁头号、扇区号标识一个扇区)，数据字段(可存放512个字节数据)
磁盘设备 机电设备
寻道时间 启动磁臂的时间和磁头移动n条磁道花费的时间和
传输时间的大小与每次所读/写的字节数和旋转速度

文件系统的用户接口，文件的命名、类型、属性和对文件的操作
圆点后面的部分称为文件扩展名
它进行存取
文件系统管理，对数据信息进行长期、大量存储和访问的功能
无结构字节序列(流式文件)、固定长度记录序列、树形结构
把文件记作中心思想，读操作返回一个记录，而写操作重写或追加一个记录
文件的类型有正规文件、目录文件、字符设备文件和块设备文件
正规文件一般分为ASCII文件和二进制文件
目录文件用于管理文件的系统文件
字符设备文件和输入/输出有关，用于串行I/O设备，如终端、打印机和网络
块设备文件用于磁盘类设备
ASCII文件由多行正文组成，回车符和换行符，优势：可以显示和打印，也可以用通常的文本编辑器进行编辑

文件存取，随机存取又称直接存取，顺序存取  存取方式有文件的性质和文件的使用情况
GETATTRIBUTES操作用于获取文件属性
调用读文件，内存缓冲区
RENAME、CREATE、WRITE、OPEN(属性和地址信息)
文件系统提供文件和文件夹记录文件
文件目录的组织和管理，包括单层目录(根目录)、两级目录(主目录和用户目录)和树形目录
目录文件有两种常见的结构：属性放在目录项中和放在i节点中
属性目录，文件名还需要给到文件的路径
i结点文件的属性和地址
windows \ \program\practice\test
UNIX /  相对路径：/practice/test 绝对路径：/program/practice/test
i结点方法 文件的属性和文件的磁盘地址
内存的链接表 文件的族号存放在内存的表中
磁盘链接表 缺点随机存取，优点充分利用每个族，不会因为磁盘碎片浪费存储空间，管理页比较简单 链接表、族号 
连续分配方式 第一块磁盘的地址和文件的块数 读操作性能号 每个文件作为一连串的连续数据块
内存的链接表













